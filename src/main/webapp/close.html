<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>test close</title>
    <script src="plugin/jquery/jquery-3.1.1.min.js"></script>
</head>
<body onload="onload_handle()">
<a href="http://www.baidu.com">baidu</a>
<script type="text/javascript">
    window.onbeforeunload = onunload_handle;
    function onunload_handle(event){
        debugger
        if (window.localStorage) {
            // flag the page as being unloading
            window.localStorage['myUnloadEventFlag']=new Date().getTime();
        }
        // notify the server that we want to disconnect the user in a few seconds (I used 5 seconds)
        askServerToDisconnectUserInAFewSeconds(); // synchronous AJAX call
        alert(123);
    }
    function onload_handle(event){
        if (window.localStorage) {
            var t0 = Number(window.localStorage['myUnloadEventFlag']);
            if (isNaN(t0)) t0 = 0;
            var t1 = new Date().getTime();
            var duration = t1 - t0;
            if (duration < 10 * 1000) {
                // less than 10 seconds since the previous Unload event => it's a browser reload (so cancel the disconnection request)
                askServerToCancelDisconnectionRequest(); // asynchronous AJAX call
            } else {
                // last unload event was for a tab/window close => do whatever you want (I do nothing here)
            }
        }
    }

    function askServerToDisconnectUserInAFewSeconds(){
        var t0 = Number(window.localStorage['myUnloadEventFlag']);
        var url = "close";
        $.get(url,{timee:t0, type:"disconnect"},function(result){});
        return "";
    }
    function askServerToCancelDisconnectionRequest(){
        var t0 = Number(window.localStorage['myUnloadEventFlag']);
        var url = "close";
        $.get(url,{timee:t0, type:"cancle disconnect"},function(result){});
    }
</script>
</body>
</html>